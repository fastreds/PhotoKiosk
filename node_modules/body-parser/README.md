# PhotoKiosk

PhotoKiosk es una aplicación web interactiva diseñada para eventos, que permite a los usuarios tomarse fotos, aplicarles marcos temáticos y recibirlas por correo electrónico o mediante un código QR. Incluye un panel de administración protegido por contraseña para gestionar los marcos de fotos disponibles.

## Características

### Kiosco para Usuarios (`/index.html`)
- **Captura de Fotos**: Interfaz sencilla para tomar fotos usando la cámara del dispositivo.
- **Aviso de Privacidad**: Muestra un aviso de privacidad antes de activar la cámara.
- **Selección de Marcos**: Los usuarios pueden elegir entre una galería de marcos disponibles.
- **Vista Previa en Vivo**: El marco seleccionado se superpone en la vista de la cámara en tiempo real.
- **Composición de Imagen**: El servidor combina la foto capturada con el marco seleccionado.
- **Opciones de Entrega**:
  - **Correo Electrónico**: Los usuarios pueden ingresar su email para recibir la foto.
  - **Código QR**: Se puede generar un código QR para descargar la foto directamente en un dispositivo móvil.

### Panel de Administración (`/admin.html`)
- **Acceso Protegido**: Protegido por una contraseña (configurable en el código).
- **Gestión de Marcos**:
  - **Listado Centralizado**: Muestra todos los marcos de fotos existentes en el servidor.
  - **Disponibilidad**: Permite activar o desactivar marcos para que aparezcan o no en el kiosco.
  - **Eliminar Marcos**: Opción para borrar permanentemente los archivos de los marcos.
  - **Subir Marcos**: Permite subir nuevos archivos de marcos (e.g., `.png`) al sistema.
- **Herramientas de Edición de Marcos**:
  - **Eliminar Fondo**: Utiliza `@imgly/background-removal-node` para quitar el fondo de un marco con un solo clic.
  - **Creador de Marcos "Nano Banana"**: Una herramienta simple para crear marcos básicos con un borde de color y texto personalizado.

## Tech Stack

### Backend
- **Node.js**: Entorno de ejecución de JavaScript.
- **Express.js**: Framework para la creación del servidor y las rutas API.
- **Sharp**: Para la composición y redimensionado de imágenes de alto rendimiento.
- **Jimp**: Utilizado para la manipulación de imágenes a nivel de píxeles (en la función `clean-grid`).
- **`@imgly/background-removal-node`**: Para la eliminación automática de fondos en los marcos.
- **Multer**: Middleware para la gestión de subida de archivos.
- **Nodemailer**: Para el envío de correos electrónicos a través de SMTP.
- **qrcode**: Para la generación de códigos QR.

### Frontend
- **HTML5, CSS3, JavaScript (Vanilla)**: Estructura, estilo y lógica del lado del cliente.
- **SweetAlert2**: Para mostrar modales y alertas interactivas y atractivas.

## Estructura del Proyecto

```
PhotoKiosk/
├── public/
│   ├── frames/         # Almacena los archivos de imagen de los marcos.
│   ├── photos/         # Almacena las fotos finales generadas.
│   ├── uploads/        # Directorio temporal para las fotos capturadas.
│   ├── admin.html      # Panel de administración.
│   ├── admin.js        # Lógica del panel de administración.
│   ├── index.html      # Página principal del kiosco.
│   └── script.js       # Lógica del kiosco.
├── frames.json         # Archivo JSON que gestiona el estado de los marcos (e.g., disponibilidad).
├── server.js           # Lógica del servidor, APIs y procesamiento de imágenes.
├── package.json
└── README.md
```

## Instalación y Puesta en Marcha

1.  **Clonar el repositorio**:
    ```bash
    git clone <url-del-repositorio>
    cd PhotoKiosk
    ```

2.  **Instalar dependencias**:
    Asegúrate de tener Node.js instalado.
    ```bash
    npm install
    ```

3.  **Configurar Credenciales (Importante)**:
    - **Correo Electrónico**: En `server.js`, las credenciales de Nodemailer están hardcodeadas. Para producción, es **muy recomendable** moverlas a variables de entorno utilizando un paquete como `dotenv`.
      ```javascript
      // server.js
      let transporter = nodemailer.createTransport("smtps://USUARIO%40gmail.com:CONTRASEÑA@smtp.gmail.com:465");
      ```
    - **Contraseña de Admin**: En `public/admin.js`, la contraseña del administrador está hardcodeada. Cámbiala por una más segura.
      ```javascript
      // public/admin.js
      if (result.value === 'admin123') { ... }
      ```

4.  **Iniciar el servidor**:
    ```bash
    node server.js
    ```

5.  **Acceder a la aplicación**:
    - **Kiosco**: Abre tu navegador y ve a `http://localhost:3000`.
    - **Admin**: Accede a `http://localhost:3000/admin.html`.

## API Endpoints

El archivo `server.js` expone los siguientes endpoints:

### Kiosco
- `GET /frames`: Devuelve una lista de los nombres de los marcos disponibles.
- `POST /capture`: Recibe una foto (`multipart/form-data`) y el nombre de un marco. Compone la imagen y devuelve la URL de la foto final.
- `POST /send-email`: Recibe un `email` y una `photoUrl`. Envía la foto al correo especificado.
- `GET /qr-code`: Recibe una `photoUrl` y devuelve una imagen de código QR.

### Administración
- `POST /save-frame`: Guarda un nuevo marco subido o creado.
- `GET /admin/frames`: Devuelve una lista de todos los marcos con su estado de disponibilidad.
- `POST /admin/toggle-frame`: Cambia el estado de disponibilidad (`available`) de un marco.
- `DELETE /admin/delete-frame`: Elimina un archivo de marco y actualiza `frames.json`.
- `POST /admin/remove-background`: Elimina el fondo de la imagen de un marco especificado.
- `POST /admin/clean-grid`: (No implementado en el frontend) Limpia un fondo de tablero de ajedrez (blanco/gris) de una imagen, convirtiéndolo en transparente.

## Mejoras Futuras Sugeridas

- **Variables de Entorno**: Mover las credenciales de correo, contraseñas y otros valores configurables a un archivo `.env`.
- **Base de Datos**: Para una gestión más robusta, reemplazar `frames.json` con una base de datos (como SQLite o MongoDB).
- **Autenticación de Admin**: Implementar un sistema de autenticación más seguro para el panel de administración (e.g., con JWT o sesiones).
- **Limpieza Automática**: Crear un script que limpie periódicamente los directorios `photos` y `uploads` para liberar espacio.

---

Este proyecto fue creado como una solución divertida y funcional para eventos. ¡Siéntete libre de contribuir o adaptarlo a tus necesidades!